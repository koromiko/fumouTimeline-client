function displayTimeline(){var a=globalSpreadSheet;Tabletop.init({key:a,reverse:!0,callback:function(a,b){console.log(b.Model);var c=a,d={};$.each(c,function(a,b){var c=toDate(b.date),e=c.getFullYear()+"."+monthsArray[c.getMonth()],f=c.getFullYear()+"-"+c.getMonth(),g=monthsEngArray[c.getMonth()]+"."+(c.getDay()+1);b.timeLabel=e,b.detailTime=g,(null==b.readmoreurl||""==b.readmoreurl)&&(b.readmoreurl=""),null==d[f]?d[f]=[b]:d[f].push(b)}),renderWaterfallView({newsData:d})},simpleSheet:!0})}function layoutBtn(a){console.log(),a=(""==a,currentMode()),a==modeFumou?($("#mode-change-btn").text("服貿大事記"),$("#mode-change-btn").attr("href","#sunflower"),displayTimeline()):a==modeSunflower&&($("#mode-change-btn").attr("href","#fumou"),$("#mode-change-btn").text("太陽花學運"),$("#waterfall-container").html('<font style="color:white">建構中</font>'))}function modeBtnActionBinding(){$("#mode-change-btn").click(function(){var a=2e3;$("#cover-image").fadeOut("fade",function(){$("#cover-image").attr("class",modeToClass(currentMode())),layoutBtn(targetMode()),$("#cover-image").fadeIn(a)})}).mouseenter(function(){$("#mode-change-btn").text(modeToTitle(targetMode()))}).mouseleave(function(){$("#mode-change-btn").text(modeToTitle(currentMode()))})}function currentMode(){var a=window.location.hash.substring(1);return""!=a?a:modeFumou}function targetMode(){var a=currentMode();return a==modeSunflower?modeFumou:a==modeFumou?modeSunflower:void 0}function modeToClass(a){return a==modeSunflower?"cover-sunflower":a==modeFumou?"cover-fumou":void 0}function modeToTitle(a){return a==modeSunflower?"太陽花學運":a==modeFumou?"服貿大事記":void 0}function toDate(a){var b=new Date(Date.parse(a));return b}function renderWaterfallView(a){var b=$("#waterfall-container");loadTemplate("item-template.html",a,b,function(){$.each(a.newsData,function(a){var b=$("#waterfall-container-"+a);b.imagesLoaded(function(){b.masonry({itemSelector:".item"})})});skrollr.init()})}function loadTemplate(a,b,c,d){$.ajax({url:a,dataType:"text",success:function(a){var e=Handlebars.compile(a),f=e(b);c.html(f),d&&d()}})}var globalSpreadSheet="https://docs.google.com/spreadsheet/pub?key=0Avv7Q0VS0N-wdFFudFhCNEQ4Wmo1WW1VbGxaZXhRNGc&output=html",monthsArray="一月,二月,三月,四月,五月,六月,七月,八月,九月,十月,十一月,十二月".split(","),monthsEngArray="Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec".split(","),source=["中央社","蘋果日報"],modeFumou="fumou",modeSunflower="sunflower";$(document).ready(function(){displayTimeline(),$("#cover-image").attr("class",modeToClass(currentMode()))});